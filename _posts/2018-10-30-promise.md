---
title: ES6 Promise
description: 
categories: JSåŸºç¡€
tags: 
---  
### ä»€ä¹ˆæ˜¯Promise 
Promiseæ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå®ƒæœ‰ä¸‰ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯**pending-è¿›è¡Œä¸­**ã€**resolved-å·²å®Œæˆ**ã€**rejected-å·²å¤±è´¥**  
å½“Promiseçš„çŠ¶æ€åˆpendingè½¬å˜ä¸ºresolvedæˆ–rejectedæ—¶ï¼Œä¼šæ‰§è¡Œç›¸åº”çš„æ–¹æ³•ï¼Œå¹¶ä¸”çŠ¶æ€ä¸€æ—¦æ”¹å˜ï¼Œå°±æ— æ³•å†æ¬¡æ”¹å˜çŠ¶æ€ï¼Œè¿™ä¹Ÿæ˜¯å®ƒåå­—promise-æ‰¿è¯ºçš„ç”±æ¥  

### Promiseçš„åŸºæœ¬ç”¨æ³•   
Promiseæ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯resolveå’Œrejectã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œç”± JavaScript å¼•æ“æä¾›ï¼Œä¸ç”¨è‡ªå·±éƒ¨ç½²ã€‚  
resolveå‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†Promiseå¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œæˆåŠŸâ€ï¼ˆå³ä» pending å˜ä¸º resolvedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ï¼›rejectå‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†Promiseå¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œå¤±è´¥â€ï¼ˆå³ä» pending å˜ä¸º rejectedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ã€‚  
Promiseå®ä¾‹ç”Ÿæˆä»¥åï¼Œå¯ä»¥ç”¨thenæ–¹æ³•åˆ†åˆ«æŒ‡å®šresolvedçŠ¶æ€å’ŒrejectedçŠ¶æ€çš„å›è°ƒå‡½æ•°  
**æ³¨æ„ï¼šå®ä¾‹åŒ–çš„Promiseå¯¹è±¡ä¼šç«‹å³æ‰§è¡Œ**
````javascript
const promise = new Promise(function(resolve, reject) {
  // ... some code

  if (/* å¼‚æ­¥æ“ä½œæˆåŠŸ */){
    resolve(value);
  } else {
    reject(error);
  }
});
 
promise.then(function(value) {
  // success
}, function(error) {
  // failure
});
````   
#### ğŸŒ°å¼‚æ­¥åŠ è½½å›¾ç‰‡
````javascript
//å¼‚æ­¥åŠ è½½å›¾ç‰‡
function loadImageAsync(url){
    return new Promise(function(resolve,reject){
        const image = new Image();
        image.onload = function(){
            resolve(image);
        };
        image.onerror = function(){
            reject(new Error('error');
        };
        image.src = url;
    });
}
````
#### ğŸŒ°å®ç° Ajax æ“ä½œ
````javascript
const getJSON = function(url) {
  const promise = new Promise(function(resolve, reject){
    const handler = function() {
      if (this.readyState !== 4) {
        return;
      }
      if (this.status === 200) {
        resolve(this.response);
      } else {
        reject(new Error(this.statusText));
      }
    };
    const client = new XMLHttpRequest();
    client.open("GET", url);
    client.onreadystatechange = handler;
    client.responseType = "json";
    client.setRequestHeader("Accept", "application/json");
    client.send();

  });

  return promise;
};

getJSON("/posts.json").then(function(json) {
  console.log('Contents: ' + json);
}, function(error) {
  console.error('å‡ºé”™äº†', error);
});
```` 



### å‚è€ƒ  
- [å»–é›ªå³°](https://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/0014345008539155e93fc16046d4bb7854943814c4f9dc2000)
- [MDN-Promise](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise)
- [Promise å¯¹è±¡](http://javascript.ruanyifeng.com/advanced/promise.html)